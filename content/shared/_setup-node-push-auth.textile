In this step, we are going to authenticate and get a token from a node.js server.  This step is for authenticating a user based on its client ID.
Install node.js if you do not have it by downloading it from <a href="https://nodejs.org">here.</a>

Next, create a folder called 'pushdemo' and install Node.js server components using 'Node Package Manager' a.k.a 'npm'

Create a file called 'app.js' and add the following code for authentication.

In app.js, we need to check the capability of a user. If the username is empty, which means that the user is not authenticated and the method will construct only 'subscribe' capabilities. The below code handles both the scenarios:

```[javascript]
   /* Check if the user wants to log in */
    if (username !== undefined) {
    /* Issue a token request with pub & sub permissions on all channels +
       configure the token with an identity */
       console.log(req.cookies.username);
    tokenParams = {
      'capability': { '*': ['publish', 'subscribe',  'push-admin', 'push-subscribe'] },
      'clientId': username
    };
  } else {
    /* Issue a token with subscribe privileges restricted to one channel
       and configure the token without an identity (anonymous) */
    tokenParams = {
      'capability': { 'notifications': ['subscribe'] }
    };
  }
```

The objective of the above step is to provide privilege to the device based on authentication. If the username is empty, then the device can only be subscribed to a push notification. It will not be able to send a push message from this device.

h2. Tokens
All clients authenticating with Ably must use either use an API key or a token. Tokens are obtained by sending a 'TokenRequest' containing the required token spec to the Ably service. The token may include a set of capabilities (permissions such as subscriber access to a specific channel), an identity (such as the logged-in user’s unique ID) or a TTL (the time before the token expires).

h2. Token Requests
Token requests, unlike tokens, are created and signed by your server without having to communicate with Ably. A token request is simply a JSON object that contains a pre-authorization from your server for a client, effectively stating “Ably, with this signed token, I authorize you to issue a token according to the permissions, ID, and TTL specified, to whoever hands this to you”. Ably is then able to inspect the signature to ensure that the token request is indeed from your server and signed with your private API key. Ably will then issue a token to the client requesting the token. Ably ensures that token requests can only be used soon after creation and can only be used once.
In order to issue a token, we need to make a token request as follows.

```[javascript]
   rest.auth.createTokenRequest(tokenParams, function(err, tokenRequest) {
    if (err) {
      res.status(500).send('Error requesting token: ' + JSON.stringify(err));
    } else {
      res.setHeader('Content-Type', 'application/json');
      res.send(JSON.stringify(tokenRequest));
    }
   });
```
