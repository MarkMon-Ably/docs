---
title: TFL DSX
section: dsx
index: 1001
languages:
  - javascript
jump_to:
  TFL:
    - Introduction
---

h1. DSX with TFL

h2. Introduction

DSX is able to help spread vast amounts of data.

h2. Example

You can get useful information from TFL, such as arrivals at stations and existing disruptions, using Ably DSX. Below is an example:

<div>
  <div>
    Station NAPTAN code: <input type="text" id="message-text" value="940GZZLUEUS"> <button id="send-message">Change channel</button>
  </div>
  <textarea id="result" rows="20" style="width: 80%; margin-top: 10px; font-family: courier, courier new; background-color: #333; color: orange" disabled></textarea>
</div>

h2. Code example

This is done by using the following code to obtain the TFL data:

```[javascript]
  var ably = new Ably.Realtime('API_KEY');
  var channelName = '[product:TFL/Tube]tube:940GZZLUEUS:arrivals',
  var channel = ably.channels.get(channelName),
```

The above will allow you to obtain all TFL information available in Ably. The above for example is getting arrivals information and updates in the Euston Underground station.

<script src="//cdn.ably.io/lib/ably.min-1.js" crossorigin="anonymous"></script>
<script src="https://apis.google.com/js/api.js"></script>
<script type="text/javascript">
  window.addEventListener("load", function() {
    var ably = new Ably.Realtime({ authUrl: 'https://www.ably.io/ably-auth/token/dsx' }),
        channelName = '[product:TFL/Tube]tube:940GZZLUEUS:arrivals',
        channel = ably.channels.get(channelName),
        $result = $('#result');

    ably.connection.on('connecting', function() {
      log("[Connecting to Ably...]");
    });

    ably.connection.on('connected', function() {
      log("[Connected to Ably] Waiting for messages...");
    });

    channel.subscribe(function(msg) {
      let d = 200;
      for(let key in msg.data) {
        let message = '[Message] Station: ' + msg.data[key].stationName + '. Next arrival on ' +
                      msg.data[key].lineName + ' line on platform: ' + msg.data[key].platformName +
                      ' towards ' + msg.data[key].towards + ' arrives at ' + msg.data[key].expectedArrival;
        setTimeout(() => { log(message) }, d);
        d += 200;
      }
    });

    $('button#send-message').on('click', function() {
      var text = $('input#message-text').val();
      log("[Changing channel to station...] " + text);
      channel = ably.channels.get('[product:TFL/Tube]tube:' + text + ':arrivals');
    });

    var started = new Date().getTime();
    function log(msg) {
      $result.text(msg + "\n" + $result.text());
    }
  });
</script>