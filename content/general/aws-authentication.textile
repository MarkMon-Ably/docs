---
title: AWS authentication
section: general
index: 20
meta_description: "There are two AWS authentication schemes that can be used when working with Ably: Credentials and the ARN of an assumable role."
meta_keywords: "Ably, AWS, credentials, ARN, ARN of assumable role, SQS, Lambda, Kinesis."
jump_to:
  Help with:
    - Credentials#credentials
    - ARN of an assumable role#aws-arn
    - Testing the rule#testing-rule
---

When adding an Integration rule for an AWS endpoint such as for an "AWS Lambda function rule":/general/events/aws-lambda/, or a "Firehose rule":/general/firehose/ for AWS Kinesis or AWS SQS, there are two AWS authentication methods that can be used with Ably:

1. Credentials
2. ARN of an assumable role 

h2(#aws-credentials). Credentials

These are a set of credentials for an AWS IAM user that has permission to invoke your Lamda function, and, in the case of a Firehose rule, publish to your AWS SQS queue or AWS Kinesis stream. These credentials comprise of the 'access key id' and the 'secret access key' for the AWS IAM user. These are entered into the rule dialog as @access_key_id:secret_access_key@, that is, as a key-value pair, joined by a single colon (without a space). You can read more about these credentials in the AWS blog article "How to quickly find and update your access keys, password, and MFA setting using the AWS Management Console":https://aws.amazon.com/blogs/security/how-to-find-update-access-keys-password-mfa-aws-management-console/.

This is the simplest scheme, and is recommended for most use cases. If you're not sure which scheme to use, specify credentials.

h2(#aws-arn). ARN of an assumable role

This scheme enables you to delegate access to resources on your account using an IAM role that the Ably AWS account can assume, avoiding the need to share user credentials with Ably. See "this AWS blog article on roles":http://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html.

When using this scheme there are several steps you need to carry out:

1. Create a role
2. Set the trust relationship for the role
3. Create the policy
4. Attach the policy to the role

These are documented in the following sections.

h3(#create-role). Create a role

Create an IAM role as follows:

1. In the AWS IAM console, click "Roles" in the sidebar and then click the "Create Role" button.

<a href="/images/screenshots/iam/create-role.png" target="_blank">
  <img src="/images/screenshots/iam/create-role.png" style="width: 100%" alt="Create Role">
</a>

2. For type of trusted entity select "Another AWS account".

<a href="/images/screenshots/iam/select-type-of-trusted-entity.png" target="_blank">
  <img src="/images/screenshots/iam/select-type-of-trusted-entity.png" style="width: 100%" alt="Select type of trusted entity">
</a>

3. For Account ID specify 203461409171. This is the Ably AWS account.

4. Click the "Require external ID checkbox" and then enter an external ID of @<Your_Ably_Account_ID>.<Your_Ably_app_ID>@. This is also displayed to you when you create an Ably Lambda Rule and select the "ARN of an assumable role" radio button in the create rule dialog.

5. Click "Next: Permissions".

6. You can create a Policy later, so click "Next: Tags".

7. You don't need to add tags so click "Next: Review".

8. Enter a suitable name for your role.

<a href="/images/screenshots/iam/review-and-create-role.png" target="_blank">
  <img src="/images/screenshots/iam/review-and-create-role.png" style="width: 100%" alt="Review and create Role">
</a>

9. Click "Create Role".

h3(#set-trust-relationship). Set the trust relationship

You have created a role. You now need to set the trust relationship for the role.

1. Click "Roles" in the sidebar of the IAM console.

2. Click on the role you just created.

<a href="/images/screenshots/iam/select-your-role.png" target="_blank">
  <img src="/images/screenshots/iam/select-your-role.png" style="width: 100%" alt="Select your Role">
</a>

3. Click the "Trust relationship" tab. 

4. Click "Edit trust relationship".

<a href="/images/screenshots/iam/trust-relationships.png" target="_blank">
  <img src="/images/screenshots/iam/trust-relationships.png" style="width: 100%" alt="Trust relationships">
</a>

5. Check that the JSON is similar to as follows:

```[json]
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::203461409171:root"
      },
      "Action": "sts:AssumeRole",
      "Condition": {
        "StringEquals": {
          "sts:ExternalId": "<Your_Ably_Account_ID>.<Your_Ably_app_ID>"
        }
      }
    }
  ]
}
```

Note, this should have been created for you, based on the information you provided when you created the role.

6. Click "Cancel".

You now have a role that will be used by the Ably AWS account, but your role will not have permissions to invoke your Lambda function. You need to create a suitable policy and attach it to this role.

h3(#create-policy). Create a policy

To create a policy:

1. In the IAM console sidebar select "Policies"

<a href="/images/screenshots/iam/create-policy.png" target="_blank">
  <img src="/images/screenshots/iam/create-policy.png" style="width: 100%" alt="Create policy">
</a>

2. Click "Create Policy".

3. Choose "Lambda" as the service. (Or other AWS service as applicable, such as AWS SQS, or AWS Kinesis).

<a href="/images/screenshots/iam/select-service.png" target="_blank">
  <img src="/images/screenshots/iam/select-service.png" style="width: 80%" alt="Select service">
</a>

4. Type "Invoke" into the filter actions box.

5. Select the "InvokeFunction" checkbox.

<a href="/images/screenshots/iam/select-action.png" target="_blank">
  <img src="/images/screenshots/iam/select-action.png" style="width: 80%" alt="Select action">
</a>

**Note:** Ably generally uses the batch version of the action where relevant; for example, for AWS SQS, Ably uses the @SendMessageBatch@ action, not the @SendMessage@ action.

6. For "Resources" you will enter the ARN of your Lambda function as the specific resource. 

7. Click "Add ARN". Enter the region your Lambda function is hosted in. Also enter the name of the Lambda function.

<a href="/images/screenshots/iam/add-arn.png" target="_blank">
  <img src="/images/screenshots/iam/add-arn.png" style="width: 80%" alt="Add ARN">
</a>

8. Click "Next: Tags". You don't need to add any tags.

9. Click "Next: Review".

10. Enter a suitable name for your Policy.

<a href="/images/screenshots/iam/review-and-create-policy.png" target="_blank">
  <img src="/images/screenshots/iam/review-and-create-policy.png" style="width: 100%" alt="Review and create policy">
</a>

11. Click "Create Policy".

The policy giving permissions to invoke a Lambda function has been created. You now need to attach it to the Role that you'll specify in your Ably Lambda Rule.

h3(#attach-policy). Attach the policy to the role

1. Click on "Roles" in the IAM console sidebar.

2. Select the role you created earlier, which is the one you'll specify in the Ably Lambda rule.

3. On the "Permissions" tab, click "Attach policies".

<a href="/images/screenshots/iam/attach-policies.png" target="_blank">
  <img src="/images/screenshots/iam/attach-policies.png" style="width: 100%" alt="Attach policies">
</a>

4. In the filter policies text box start typing your policy name. When it is displayed make sure you select its checkbox.

5. Then click "Attach policy". Your role now has the permissions specified in this policy, that is, it can invoke the Lambda function that you specified in the role.

<a href="/images/screenshots/iam/attach-policy.png" target="_blank">
  <img src="/images/screenshots/iam/attach-policy.png" style="width: 100%" alt="Attach policy">
</a>

h3(#obtaining-the-arn). Obtaining the ARN of the role

You can copy the ARN for your rule using the button provided:

<a href="/images/screenshots/iam/copy-arn.png" target="_blank">
  <img src="/images/screenshots/iam/copy-arn.png" style="width: 80%" alt="Copy ARN">
</a>

h3(#using-the-arn). Using the ARN of the role

When creating the Ably Lambda rule, enter the ARN of the rule created into the "Assume Role ARN" text field of the rule creation dialog. 

<a href="/images/screenshots/iam/assume-arn-role.png" target="_blank">
  <img src="/images/screenshots/iam/assume-arn-role.png" style="width: 80%" alt="Assume ARN Role">
</a>

h2(#testing-rule). Testing the rule

You can test out your Ably rule by clicking "Test rule" in the Dashboard. If the test returns success you have the necessary permissions in place and are correctly configured.

<a href="/images/screenshots/iam/test-rule.png" target="_blank">
  <img src="/images/screenshots/iam/test-rule.png" style="width: 100%" alt="Test rule">
</a>
