---
title: AWS authentication
section: general
index: 20
meta_description: "There are two AWS authentication schemes that can be used when working with Ably: Credentials and the ARN of an assumable role."
meta_keywords: "Ably, AWS, credentials, ARN, ARN of assumable role, SQS, Lambda, Kinesis."
jump_to:
  Help with:
    - Credentials#aws-credentials
    - ARN of an assumable role#aws-arn
    - Create a policy#create-policy
    - Create a role#create-role
    - Testing the rule#testing-rule
---

When adding an Integration rule for an AWS endpoint such as for an "AWS Lambda function rule":/general/events/aws-lambda/, or a "Firehose rule":/general/firehose/ for AWS Kinesis or AWS SQS, there are two AWS authentication methods that can be used with Ably:

1. Credentials
2. ARN of an assumable role 

h2(#aws-credentials). Credentials

These are a set of credentials for an AWS IAM user that has permission to invoke your Lamda function, and, in the case of a Firehose rule, publish to your AWS SQS queue or AWS Kinesis stream. These credentials comprise of the 'access key id' and the 'secret access key' for the AWS IAM user. These are entered into the rule dialog as @access_key_id:secret_access_key@, that is, as a key-value pair, joined by a single colon (without a space). You can read more about these credentials in the AWS blog article "How to quickly find and update your access keys, password, and MFA setting using the AWS Management Console":https://aws.amazon.com/blogs/security/how-to-find-update-access-keys-password-mfa-aws-management-console/.

This is not the recommended approach, as "AWS best practices":https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#sharing-credentials state you should not share your access keys with third-parties.

When using this scheme you need to "create a policy":#create-policy.

h2(#aws-arn). ARN of an assumable role

This scheme enables you to delegate access to resources on your account using an IAM role that the Ably AWS account can assume, avoiding the need to share user credentials with Ably. See "this AWS blog article on roles":http://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html. 

This is the recommended scheme as it follows "AWS best practices":https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#sharing-credentials, and means you do not need to share your 'access key id' and the 'secret access key' with Ably.

When using this scheme there are two steps you need to carry out:

1. "Create a policy":#create-policy
2. "Create a role":#create-role

h2(#create-policy). Create a policy

To create a policy:

1. In the IAM console sidebar select "Policies":

<a href="/images/screenshots/iam/create-policy.png" target="_blank">
  <img src="/images/screenshots/iam/create-policy.png" style="width: 100%" alt="Create policy">
</a>

2. Click "Create Policy".

3. Choose "Lambda" as the service. (Or other AWS service as applicable, such as AWS SQS, or AWS Kinesis).

<a href="/images/screenshots/iam/select-service.png" target="_blank">
  <img src="/images/screenshots/iam/select-service.png" style="width: 80%" alt="Select service">
</a>

4. Type "Invoke" into the filter actions box.

5. Select the "InvokeFunction" checkbox.

<a href="/images/screenshots/iam/select-action.png" target="_blank">
  <img src="/images/screenshots/iam/select-action.png" style="width: 80%" alt="Select action">
</a>

**Note:** Ably generally uses the batch version of the action where relevant; for example, for AWS SQS, Ably uses the @SendMessageBatch@ action, not the @SendMessage@ action.

6. For "Resources" you will enter the ARN of your Lambda function as the specific resource. 

7. Click "Add ARN". Enter the region your Lambda function is hosted in. Also enter the name of the Lambda function.

<a href="/images/screenshots/iam/add-arn.png" target="_blank">
  <img src="/images/screenshots/iam/add-arn.png" style="width: 80%" alt="Add ARN">
</a>

8. Click "Next: Tags". You don't need to add any tags.

9. Click "Next: Review".

10. Enter a suitable name for your Policy.

<a href="/images/screenshots/iam/review-and-create-policy.png" target="_blank">
  <img src="/images/screenshots/iam/review-and-create-policy.png" style="width: 100%" alt="Review and create policy">
</a>

11. Click "Create Policy".

The policy giving permissions to invoke a Lambda function has been created. You now need to attach it to the role that you'll specify in your Ably Lambda Rule. The next step is to create the role.

h2(#create-role). Create a role

Create an IAM role as follows:

1. In the AWS IAM console, click "Roles" in the sidebar and then click the "Create Role" button.

<a href="/images/screenshots/iam/create-role.png" target="_blank">
  <img src="/images/screenshots/iam/create-role.png" style="width: 100%" alt="Create Role">
</a>

2. For type of trusted entity select "Another AWS account".

<a href="/images/screenshots/iam/select-type-of-trusted-entity.png" target="_blank">
  <img src="/images/screenshots/iam/select-type-of-trusted-entity.png" style="width: 100%" alt="Select type of trusted entity">
</a>

3. For Account ID specify 203461409171. This is the Ably AWS account.

4. Click the "Require external ID checkbox" and then enter an external ID of @<Your_Ably_Account_ID>.<Your_Ably_app_ID>@. This is also displayed to you when you create an Ably Lambda Rule and select the "ARN of an assumable role" radio button in the create rule dialog.

5. Click "Next: Permissions".

6. Now select the policy you created earlier to attach to this role. You can type the name of your policy into the "Filter policies" search box:

<a href="/images/screenshots/iam/select-policy.png" target="_blank">
  <img src="/images/screenshots/iam/select-policy.png" style="width: 100%" alt="Select type of trusted entity">
</a>

Then ensure the checkbox for the policy is selected.

7. Click "Next: Tags".

8. You don't need to add tags so click "Next: Review".

9. Enter a suitable name for your role.

<a href="/images/screenshots/iam/review-and-create-role.png" target="_blank">
  <img src="/images/screenshots/iam/review-and-create-role.png" style="width: 100%" alt="Review and create Role">
</a>

9. Click "Create Role".

h3(#obtaining-the-arn). Obtaining the ARN of the role

When setting up an Ably integration rule, you can copy the ARN for your rule using the button provided:

<a href="/images/screenshots/iam/copy-arn.png" target="_blank">
  <img src="/images/screenshots/iam/copy-arn.png" style="width: 80%" alt="Copy ARN">
</a>

h3(#using-the-arn). Using the ARN of the role

When creating the Ably Lambda rule, enter the ARN of the rule created into the "Assume Role ARN" text field of the rule creation dialog. 

<a href="/images/screenshots/iam/assume-arn-role.png" target="_blank">
  <img src="/images/screenshots/iam/assume-arn-role.png" style="width: 80%" alt="Assume ARN Role">
</a>

h2(#testing-rule). Testing the rule

You can test out your Ably rule by clicking "Test rule" in the Dashboard. If the test returns success you have the necessary permissions in place and are correctly configured.

<a href="/images/screenshots/iam/test-rule.png" target="_blank">
  <img src="/images/screenshots/iam/test-rule.png" style="width: 100%" alt="Test rule">
</a>
